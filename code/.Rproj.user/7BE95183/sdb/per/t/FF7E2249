{
    "contents" : "estimate.probabilities<-function(sim.data){\n  #Estimate choice probabilities, and calculate covariance matrix for estiamtes\n  probs=group_by(sim.data, bucket, choice) %>%\n    summarise(sim.prob=n()) %>%\n    ungroup() %>%\n    mutate(sim.prob=sim.prob/sum(sim.prob))\n  prob.mat=matrix(probs$sim.prob, nr=nrow(probs), nc=nrow(choices)) %>%\n    t()\n  choice.mat=dcast(sim.data, trial~bucket+choice, value.var='choice', fun.aggregate=length) %>%\n    select(-trial)  \n  list(\n    prob=probs, \n    cov=cov(prob.mat-choice.mat)/nrow(sim.data)\n  )\n}\n\nrun.wald<-function(actual.prob, sim.prob, cov){\n  #Run a Wald test that the probability estimates, sim.prob, equal the theoretical probabilities, actual.prob. I drop the last parameter, which is linearly dependent on the others\n  K=length(sim.prob)\n  actual.prob=actual.prob[-K]\n  sim.prob=sim.prob[-K]\n  cov=cov[-K, -K]\n  (sim.prob-actual.prob)%*%solve(cov, (sim.prob-actual.prob)) %>%\n    pchisq(df=K-1) %>%\n    sum(-1) %>%\n    prod(-1)\n}",
    "created" : 1406513141749.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "107856347",
    "id" : "FF7E2249",
    "lastKnownWriteTime" : 1406513252,
    "path" : "~/Dropbox/teaching/OPNS910/assignments/OPNS910_Hendel2006/github/code/modules/estimateProbabilities.R",
    "project_path" : "modules/estimateProbabilities.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "source_on_save" : false,
    "type" : "r_source"
}